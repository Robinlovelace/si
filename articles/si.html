<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="si">
<title>Spatial interaction models with R • si</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Spatial interaction models with R">
<meta property="og:description" content="si">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">si</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/si.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/sims.html">An introduction to spatial interaction models: from first principles</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/robinlovelace/si/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="si_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Spatial interaction models with R</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/robinlovelace/si/blob/HEAD/vignettes/si.Rmd" class="external-link"><code>vignettes/si.Rmd</code></a></small>
      <div class="d-none name"><code>si.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="prerequisites">Prerequisites<a class="anchor" aria-label="anchor" href="#prerequisites"></a>
</h2>
<p>You need to have <a href="https://cran.r-project.org/" class="external-link">installed R</a> and a suitable editor such as <a href="https://www.rstudio.com/products/rstudio/download/preview/" class="external-link">RStudio</a> or <a href="https://github.com/REditorSupport/vscode-R" class="external-link">VSCode with R plugin</a>. See the package’s <a href="https://robinlovelace.github.io/si/">README</a> for instructions on installing the {si} package.</p>
<!--#  Test the necessary packages are installed by loading them (we will also use {dplyr}):-->
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/robinlovelace/si" class="external-link">si</a></span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="input-data">Input data<a class="anchor" aria-label="anchor" href="#input-data"></a>
</h2>
<p>This tutorial builds on a <a href="https://github.com/adamdennett/SIModelling/blob/SIModelling-Edits/SimAus2.Rmd" class="external-link">reproducible</a> guide to SIMs in R <span class="citation">(Dennett 2018)</span>.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt; See &lt;span class="citation"&gt;Dennett (2012)&lt;/span&gt; or an earlier guide on SIMs in R.&lt;/p&gt;'><sup>1</sup></a> We start by importing open access data representing movement between zones in Australia (thanks to Adam Dennett for making the files accessible):</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">u1</span> <span class="op">=</span> <span class="st">"https://github.com/Robinlovelace/si/releases/download/0.0.1/zones_aus.geojson"</span>
<span class="va">zones_aus</span> <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="va">u1</span><span class="op">)</span>
<span class="va">u2</span> <span class="op">=</span> <span class="st">"https://www.dropbox.com/s/wi3zxlq5pff1yda/AusMig2011.csv?raw=1"</span>
<span class="va">od_aus</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="va">u2</span><span class="op">)</span></code></pre></div>
<p>Let’s take a quick look at and ‘minimize’ these input datasets before modelling them with SIMs:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">zones_aus</span><span class="op">)</span>
<span class="co">#&gt; [1] 15  7</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">zones_aus</span><span class="op">)</span>
<span class="co">#&gt; [1] "GCCSA_CODE" "GCC_CODE16" "GCCSA_NAME" "STATE_CODE" "STATE_NAME"</span>
<span class="co">#&gt; [6] "AREA_SQKM"  "geometry"</span>
<span class="va">key_zone_names</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GCCSA_CODE"</span>, <span class="st">"GCCSA_NAME"</span>, <span class="st">"AREA_SQKM"</span><span class="op">)</span>
<span class="va">zones</span> <span class="op">=</span> <span class="va">zones_aus</span><span class="op">[</span><span class="va">key_zone_names</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">zones</span>, <span class="fl">2</span><span class="op">)</span>
<span class="co">#&gt; Simple feature collection with 2 features and 3 fields</span>
<span class="co">#&gt; Geometry type: MULTIPOLYGON</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: 140.9993 ymin: -37.50503 xmax: 153.6298 ymax: -28.16441</span>
<span class="co">#&gt; Geodetic CRS:  GDA94</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 4</span></span>
<span class="co">#&gt;   GCCSA_CODE GCCSA_NAME     AREA_SQKM                                   geometry</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                         <span style="color: #949494; font-style: italic;">&lt;MULTIPOLYGON [°]&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1RNSW      Rest of NSW      <span style="text-decoration: underline;">788</span>443. (((153.008 -28.34026, 153.11 -28.35709, 1…</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 1GSYD      Greater Sydney    <span style="text-decoration: underline;">12</span>368. (((151.5961 -33.16168, 151.6305 -33.17709…</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">od_aus</span><span class="op">)</span>
<span class="co">#&gt; [1] 225  13</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">od_aus</span><span class="op">)</span>
<span class="co">#&gt;  [1] "Origin"          "Orig_code"       "Destination"     "Dest_code"      </span>
<span class="co">#&gt;  [5] "Flow"            "vi1_origpop"     "wj1_destpop"     "vi2_origunemp"  </span>
<span class="co">#&gt;  [9] "wj2_destunemp"   "vi3_origmedinc"  "wj3_destmedinc"  "vi4_origpctrent"</span>
<span class="co">#&gt; [13] "wj4_destpctrent"</span>
<span class="va">key_od_names</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Orig_code"</span>, <span class="st">"Dest_code"</span>, <span class="st">"Flow"</span><span class="op">)</span>
<span class="va">od</span> <span class="op">=</span> <span class="va">od_aus</span><span class="op">[</span><span class="va">key_od_names</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">od</span>, <span class="fl">2</span><span class="op">)</span>
<span class="co">#&gt;   Orig_code Dest_code    Flow</span>
<span class="co">#&gt; 1     1GSYD     1GSYD 3395015</span>
<span class="co">#&gt; 2     1GSYD     1RNSW   91031</span></code></pre></div>
<p>The results printed above show that:</p>
<ul>
<li><p><code>zones_aus</code> represents the 15 regions of Australia, with columns containing zone identifiers (IDs), primarily <code>GCCSA_CODE</code>, and the area of each zone (<code>AREA_SQKM</code>). The minimal <code>zones</code> object contains only the region code, name, and area.</p></li>
<li><p><code>od_aus</code> contains 225 rows of data representing the movement of people between the zones in <code>aus</code>. Note that 255 is 15 squared, meaning that this OD dataset contains the complete combination of migration flows, starting with zone <code>1GSYD</code> to <code>1GSYD</code>. These codes are present in the <code>GCCSA_CODE</code> column in the <code>aus</code> object. The first row of the OD dataset represents ‘intra-zonal’ migrations in Greater Sydney, presumably counting the number of people who move house from somewhere in the region to another home in the region. There are 13 columns in this dataset, the most important of which are <code>Orig_code</code>, <code>Dest_code</code>, and <code>Flow</code>, which we have captured in the minimal <code>od</code> dataset.</p></li>
</ul>
<p>Note: a useful convention with ‘long form’ OD datasets is for the first two columns to contain zone IDs that correspond to values in the first column of the zone dataset. The R package <a href="https://itsleeds.github.io/od/" class="external-link">{od}</a>, on which {si} builds, assumes that inputs to its functions are in this form.</p>
<p>It is a good idea to verify that the origin and destination codes in the <code>od</code> dataset match the zone codes in <code>zones</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">od</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">zones</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt;    Mode    TRUE </span>
<span class="co">#&gt; logical     225</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">od</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">zones</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt;    Mode    TRUE </span>
<span class="co">#&gt; logical     225</span></code></pre></div>
<p>It is clear from the above that we have ‘clean’ input datasets, let’s begin with the modelling!</p>
</div>
<div class="section level2">
<h2 id="preparing-a-sim">Preparing a SIM<a class="anchor" aria-label="anchor" href="#preparing-a-sim"></a>
</h2>
<p>Key to the workings of the {si} package is the conversion of geographic objects representing origins and destinations into an OD dataset. In this case, we already have an OD dataset, so this step is less relevant. However, we will take this step in any case because many SIMs start without such a comprehensive OD dataset as we have in this case.</p>
<p>Prepare the OD dataset as follows:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">od_sim</span> <span class="op">=</span> <span class="fu"><a href="../reference/si_to_od.html">si_to_od</a></span><span class="op">(</span>origins <span class="op">=</span> <span class="va">zones</span>, destinations <span class="op">=</span> <span class="va">zones</span><span class="op">)</span>
<span class="co">#&gt; Maximum distance is &gt; 100km. The 'cheap' measure is inaccurate over such</span>
<span class="co">#&gt; large distances, you'd likely be better using a different 'measure'.</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">od_sim</span>, <span class="fl">2</span><span class="op">)</span>
<span class="co">#&gt; Simple feature collection with 2 features and 7 fields</span>
<span class="co">#&gt; Geometry type: LINESTRING</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: 146.9621 ymin: -33.66837 xmax: 150.7766 ymax: -32.13363</span>
<span class="co">#&gt; Geodetic CRS:  WGS 84</span>
<span class="co">#&gt;       O     D distance_euclidean origin_GCCSA_NAME origin_AREA_SQKM</span>
<span class="co">#&gt; 1 1RNSW 1RNSW                0.0       Rest of NSW         788442.6</span>
<span class="co">#&gt; 2 1RNSW 1GSYD           412344.8       Rest of NSW         788442.6</span>
<span class="co">#&gt;   destination_GCCSA_NAME destination_AREA_SQKM                       geometry</span>
<span class="co">#&gt; 1            Rest of NSW             788442.59 LINESTRING (146.9621 -32.13...</span>
<span class="co">#&gt; 2         Greater Sydney              12368.19 LINESTRING (146.9621 -32.13...</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references">
<div id="ref-dennett_estimating_2012">
<p>Dennett, Adam. 2012. “Estimating Flows Between Geographical Locations:’Get Me Started in’spatial Interaction Modelling.” <em>UCL Working Papers Series</em> 44 (0): 024. <a href="http://www.bartlett.ucl.ac.uk/casa/publications/working-paper-181" class="external-link">http://www.bartlett.ucl.ac.uk/casa/publications/working-paper-181</a>.</p>
</div>
<div id="ref-dennett_modelling_2018">
<p>———. 2018. “Modelling Population Flows Using Spatial Interaction Models.” <em>Australian Population Studies</em> 2 (2): 33–58. <a href="https://doi.org/10.37970/aps.v2i2.38" class="external-link">https://doi.org/10.37970/aps.v2i2.38</a>.</p>
</div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Robin Lovelace, Jakub Nowosad.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
