---
title: "Tutorial: spatial interaction models with R"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Tutorial: spatial interaction models with R}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
bibliography: references.bib
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

Pre-requisites: you should have [installed R](https://cran.r-project.org/) and a suitable editor such as [RStudio](https://www.rstudio.com/products/rstudio/download/preview/) or [VSCode with R plugin](https://github.com/REditorSupport/vscode-R).
See the package's [README](https://robinlovelace.github.io/si/) for instructions on installing the {si} package.

```{r setup}
library(si)
```

This tutorial builds on @dennett_modelling_2018 (which in turn builds on @dennett_estimating_2012's pioneering [reproducible](https://github.com/adamdennett/SIModelling/blob/SIModelling-Edits/SimAus2.Rmd) tutorial on SIMs with R).
We start by importing open access data representing movement between zones in Australia (thanks to Adam Dennett for making the files accessible):

```{r}
u1 = "https://www.dropbox.com/s/0fg80nzcxcsybii/GCCSA_2016_AUST_New.geojson?raw=1"
aus = sf::read_sf(u1)
u2 = "https://www.dropbox.com/s/wi3zxlq5pff1yda/AusMig2011.csv?raw=1"
od_migration_original = read.csv(u2)
```

```{r, echo=FALSE, eval=FALSE}
sf::write_sf(aus, "GCCSA_2016_AUST_New.geojson")
piggyback::pb_upload("GCCSA_2016_AUST_New.geojson")

```

Let's take a quick look at these input datasets before modelling them with SIMs:

```{r}
aus
dim(od_migration_original)
head(od_migration_original)
```

The results printed above show that:

-   `aus` represents the 15 regions of Australia, with columns containing zone identifiers (IDs), primarily `GCCSA_CODE`, and the area of each zone (`AREA_SQKM`).

-   `od_migration_original` contains 225 rows of data representing the movement of people between the zones in `aus`.
    Note that 255 is 15 squared, meaning that this OD dataset contains the complete combination of migration flows, starting with zone `1GSYD` to `1GSYD`.
    These codes are present in the `GCCSA_CODE` column in the `aus` object.
    The first row of the OD dataset represents 'intra-zonal' migrations in Greater Sydney, presumably counting the number of people who move house from somewhere in the region to another home in the region.
    There are 13 columns in this dataset, the most important of which are `Orig_code`, `Dest_code`, and `Flow`.

A useful convention with 'long form' OD datasets is for the first two columns to contain zone IDs that correspond to values in the first column of the zone dataset.
The following code cleans the raw input datasets to get the data in this ideal form, and removes all variables that we do not currently need:

```{r}
# todo
```

# References
